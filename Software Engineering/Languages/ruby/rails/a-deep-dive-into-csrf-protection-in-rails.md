# [A Deep Dive into CSRF Protection in Rails](https://medium.com/rubyinside/a-deep-dive-into-csrf-protection-in-rails-19fa0a42c0ef)

* CSRF is an attack that allow malicious users to spoof legitimate requests to the server (pretending to be an authenticated user)
  * Rails protects against attack by generating unique tokens and validating authenticity with each request
* Unique token is embedded in site HTML
* Unique token is also added to session cookie
* When user makes `POST` request, the CSRF token in HTML gets sent with request
* Rails compares session token with token from page to ensure match
* `application.html.erb` has `<%= csrf_meta_tags %>` which embeds authenticity token in HTML
* CSRF tokens are generated by 
  * Taking a one-time pad (i.e. some randomly-generated key) and `XOR`ing it with the plain-text CSRF token value
  * Prepending one-time pad
  * Base-64 encoding value
* When user submits form, a CSRF token is sent along as `authenticity_token` parameter or `X-CSRF-Token` HTTP header
* In `ApplcationController` this is a `protect_from_forgery with: :exception` that adds a before-action to life-cycle of controller action
  * This before-action compares CSRF token in request params / header with token in session cookie
* Doesn't verify `HEAD` or `GET` requests

